/**
 * Made with ❤️ by Mighty — Maestro LLC
 * Copyright © 2025 Maestro LLC
 */
var M=["MIGHTY_INTERACTIVE_CORE_LOADED","MIGHTY_INTERACTIVE_HEIGHT_REPORT","MIGHTY_INTERACTIVE_POST_CORE_LOADED_REPORT","MIGHTY_INTERACTIVE_DIRECT_CODE_HTML_REQUESTED","MIGHTY_INTERACTIVE_DIRECT_CODE_HTML_REPORT","MIGHTY_INTERACTIVE_READY_TO_DISPLAY","MIGHTY_INTERACTIVE_COMPLETE","MIGHTY_INTERACTIVE_GET_ZIP_FILE","MIGHTY_INTERACTIVE_SEND_ZIP_FILE","MIGHTY_INTERACTIVE_SCREENCAP","MIGHTY_INTERACTIVE_DYNAMIC_FORM_CONFIG","MIGHTY_INTERACTIVE_RELOAD_REQUESTED","MIGHTY_INTERACTIVE_SDK_HOST_PING","MIGHTY_INTERACTIVE_SDK_HOST_PONG","MIGHTY_INTERACTIVE_SDK_STATE_REQUESTED","MIGHTY_INTERACTIVE_SDK_STATE_PROVIDED","MIGHTY_INTERACTIVE_ERROR","MIGHTY_INTERACTIVE_SDK_MESSAGE_TO_HOST","MIGHTY_INTERACTIVE_SDK_MESSAGE_FROM_HOST"];function i(n){return typeof n=="object"&&n!==null&&typeof n.data=="object"&&n.data!==null&&M.includes(n.data.type)}var r=class{initialize(){this.postMessageToParentWindow({type:"MIGHTY_INTERACTIVE_CORE_LOADED"}),this.listenForWhenDocumentIsReady(),this.listenForMessagesFromParent()}listenForWhenDocumentIsReady(){document.readyState==="complete"?this.onDocumentReady():document.onreadystatechange=()=>{document.readyState==="complete"&&this.onDocumentReady()}}onDocumentReady(){this.listenForWhenDocumentIsResized()}listenForWhenDocumentIsResized(){this.postMightyInteractiveHeightReport(),new ResizeObserver(()=>{this.postMightyInteractiveHeightReport()}).observe(document.documentElement)}postMightyInteractiveHeightReport(){let e=document.documentElement.getBoundingClientRect().height;this.postMessageToParentWindow({type:"MIGHTY_INTERACTIVE_HEIGHT_REPORT",data:{height:Math.ceil(e)}})}postMessageToParentWindow(e){window.parent.postMessage(e,"*")}listenForMessagesFromParent(){window.addEventListener("message",e=>{if(!i(e))return;let t=e.data;switch(t.type){case"MIGHTY_INTERACTIVE_SCREENCAP":this.onMightyInteractiveScreencapMessage(t);break;case"MIGHTY_INTERACTIVE_POST_CORE_LOADED_REPORT":this.onMightyInteractivePostCoreLoadedReportMessage(t);break}})}onMightyInteractiveScreencapMessage(e){if(e.type==="MIGHTY_INTERACTIVE_SCREENCAP"){let t=e.data.html,a=new window.DOMParser().parseFromString(t,"text/html");document.replaceChild(a.documentElement,document.documentElement)}}onMightyInteractivePostCoreLoadedReportMessage(e){if(e.type==="MIGHTY_INTERACTIVE_POST_CORE_LOADED_REPORT"){let{injectCss:t,injectJavascript:s}=e.data;this.injectCssAndJavascriptSnippets({cssSnippet:t,javascriptSnippet:s}),this.postMessageToParentWindow({type:"MIGHTY_INTERACTIVE_READY_TO_DISPLAY"})}}injectCssAndJavascriptSnippets(e){let{cssSnippet:t,javascriptSnippet:s}=e;if(t!==void 0&&(document.querySelector("#mightyInteractiveOverrideCss")?.remove(),t)){let a=document.createElement("style");a.id="mightyInteractiveOverrideCss",a.innerHTML=t,document.body.appendChild(a)}if(s!==void 0&&(document.querySelector("#mightyInteractiveOverrideJavascript")?.remove(),s)){let a=document.createElement("script");a.id="mightyInteractiveOverrideJavascript",a.innerHTML=s,document.body.appendChild(a)}}};var o=class{constructor(){this.messageHandlers=new Map,this.customMessageHandlers=new Map,this.pendingCallbacks=new Map,this.requestIdCounter=0,this.listenToPostMessagesRelatedToSDK()}generateRequestId(){return`req_${Date.now()}_${++this.requestIdCounter}`}onMessageReceived(e,t){return this.messageHandlers.has(e)||this.messageHandlers.set(e,new Set),this.messageHandlers.get(e)?.add(t),()=>{this.messageHandlers.get(e)?.delete(t)}}sendHostPingMessage(){this.postMessageToInteractiveBlockWindow({type:"MIGHTY_INTERACTIVE_SDK_HOST_PING"})}sendStateRequestedMessage(e){this.postMessageToInteractiveBlockWindow({type:"MIGHTY_INTERACTIVE_SDK_STATE_REQUESTED",data:{defaultState:e}})}sendMarkAsCompleteMessage(){this.postMessageToInteractiveBlockWindow({type:"MIGHTY_INTERACTIVE_COMPLETE"})}sendMessageToHost(e){let t=e.callback?this.generateRequestId():void 0;t&&e.callback&&this.pendingCallbacks.set(t,e.callback),this.postMessageToInteractiveBlockWindow({type:"MIGHTY_INTERACTIVE_SDK_MESSAGE_TO_HOST",data:{messageType:e.messageType,payload:e.payload,requestId:t}})}onMessageFromHost(e){let{messageType:t,callback:s}=e;return this.customMessageHandlers.has(t)||this.customMessageHandlers.set(t,new Set),this.customMessageHandlers.get(t)?.add(s),()=>{this.customMessageHandlers.get(t)?.delete(s)}}listenToPostMessagesRelatedToSDK(){window.addEventListener("message",e=>{if(i(e)){let t=e.data.type;switch(t){case"MIGHTY_INTERACTIVE_SDK_HOST_PONG":this.handleMessageReceived(t,e.data.data);break;case"MIGHTY_INTERACTIVE_SDK_STATE_PROVIDED":this.handleMessageReceived(t,e.data.data.state);break;case"MIGHTY_INTERACTIVE_SDK_MESSAGE_FROM_HOST":e.data.data.requestId?this.handleResponseCallback(e.data.data.requestId,e.data.data.payload):this.handleCustomMessageFromHost(e.data.data.messageType,e.data.data.payload);break}}})}postMessageToInteractiveBlockWindow(e){window.parent!==window&&window.parent.postMessage(e,"*")}handleMessageReceived(e,t){let s=this.messageHandlers.get(e);s&&s.forEach(a=>{a(t??void 0)})}handleCustomMessageFromHost(e,t){let s=this.customMessageHandlers.get(e);s&&s.forEach(a=>{a(t)})}handleResponseCallback(e,t){let s=this.pendingCallbacks.get(e);s&&(s(t),this.pendingCallbacks.delete(e))}};var T=class{getState(e,t){return Promise.resolve(e)}};var I=class{constructor(e){this.messenger=e}async getState(e){return new Promise((t,s)=>{let c=setTimeout(()=>{s(new Error("Interactive state not provided in time"))},5e3);this.messenger.onMessageReceived("MIGHTY_INTERACTIVE_SDK_STATE_PROVIDED",_=>{clearTimeout(c),t(_)}),this.messenger.sendStateRequestedMessage(e)})}};var E=class{constructor(){this.version="1.0.0";this.sdkIsReady=!1,this.messenger=new o,this.useNoOpMode=!1}async initialize(){await this.checkForHost()||(this.useNoOpMode=!0),this.useNoOpMode?this.state=new T:this.state=new I(this.messenger),this.sdkIsReady=!0,this.sdkReadyFn?.()}onSdkReady(e){this.sdkReadyFn=e,this.sdkIsReady&&e()}markAsComplete(){this.messenger.sendMarkAsCompleteMessage()}sendMessageToHost(e){this.messenger.sendMessageToHost(e)}onMessageFromHost(e){return this.messenger.onMessageFromHost(e)}checkForHost(){return new Promise(e=>{this.messenger.onMessageReceived("MIGHTY_INTERACTIVE_SDK_HOST_PONG",t=>{t&&t.courseId&&t.blockId&&(this.courseId=t.courseId,this.blockId=t.blockId),e(!0)}),setTimeout(()=>{this.messenger.sendHostPingMessage(),setTimeout(()=>{e(!1)},100)},0)})}};var d=new E;window.mightyInteractiveSdk=d;d.initialize();var g=new r;g.initialize();
